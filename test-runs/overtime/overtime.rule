#Rule: Overtime pay based on hours worked.

WHEN envelope:type == 'pay_request';

REQUIRE test:employee_hours:0.0.1;
REQUIRE test:employee_information:0.0.1;

# Two different overtime pay formats:
REQUIRE test:overtime_pay_before:0.0.1;
REQUIRE test:overtime_pay_after:0.0.1;

# This test rule, "Overtime", attempts to apply an overtime pay-scale to the
# hours worked by the employees of a theoretical company. The current 
# implementation does not assume that an envelope with a single employee_id
# is present, and runs calculations for both a single user and the employee
# group.
#
# Ryan Fleck- ryan.fleck@protonmail.com

#RULE STEPS: Multiple implementations for each.
# 1. Sort Employees
# 2. Determine pay bracket
# 3. Multiply pay by overtime multiplier

#STEP 1:
# Employee id can be grepped as envelope:id
ASSEMBLE employee_data
  COLUMNS FROM table:employee_hours WHEN envelope:id == @employee_id 
  #Not the ideal way to match name with hours, but a good start.
  COLUMN employee_name FROM table:employee_information WHEN envelope:id == @employee_id
  COLUMNS FROM table:overtime_pay_before;

#(nonfunctional) Attempts to match emp_id with @emp_id when adding name.
## ASSEMBLE employee_data_correct
##   COLUMNS FROM table:employee_hours WHEN envelope:id == @employee_id 
##   COLUMN employee_name FROM table:employee_information WHEN employee_id == @employee_id;

#STEP 2:
#
#Using pay-below-hrs method.

FILTER table:employee_data
  WHEN @hours_before > @overtime_hours;

# Requires reduce methdod!

#STEP 3
